<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VaultITMobileSSOFramework for Android: VaultITMobileSSOFramework for Android</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VaultITMobileSSOFramework for Android
   &#160;<span id="projectnumber">1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">VaultITMobileSSOFramework for Android </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Configuration</h2>
<p>First part of the configuration is the adding the library to the Android-project. Then configuring the OpenID Client settings and the OpenID Connect Provider Discovery URL, some of the client information you'll receive when you register your application.</p>
<h3>Installation</h3>
<p>Create new Android-project. Add flatDirs-configuration to the repositories-section of the build.gradle-file: </p><pre class="fragment">allprojects {
    repositories {
        jcenter()
        flatDir {
            dirs 'libs'
    }
}
</pre><p>Copy the <em>vaultit-mobilessosdk-0.2-release.aar</em> from the distribution package to <em>app/libs</em> directory. Then add it and the <a href="https://github.com/openid/AppAuth-Android" title="AppAuth Android library">AppAuth</a> library as a dependency to the application build.gradle-file ( app/build.gradle ): </p><pre class="fragment">compile(name:'vaultit-mobilessosdk-0.2-release', ext:'aar')
compile 'net.openid:appauth:0.6.0'
</pre><p>Then do gradle sync.</p>
<h3>OpenID Connect Provider settings</h3>
<p>The library has a <em>IdentityProvider</em> class, which is used to encapsulate OpenID Connect provider settings. Client id and client secret are issued when registering your application and OpenID Connect Discovery URL is the providers discovery URL for the environment. The <em>Getting started with VaultITMobileSSOFramework</em> document has the discovery URL endpoints for different environments.</p>
<p>Below is the information that needed to construct <em>IdentityProvider</em>. The following can the application developer provide:</p><ul>
<li>name (name for the IdentityProvider)</li>
<li>buttonContentDescriptionRes (Description</li>
<li>buttonTextColorRes (Android resource color, for example Android.R.color.white)</li>
</ul>
<p>The following configuration options depend on the environment, some of them application provider receives upon registering its application for the Nordic eID.</p><ul>
<li>enabledRes (set to true)</li>
<li>discoveryEndpointRes (Environment's OpenID Connect Provider Discovery URL)</li>
<li>clientIdRes(Client id, generated when registering an application for Nordic eID)</li>
<li>clientSecretRes (Client secret, generated when registering an application for Nordic eID)</li>
<li>redirectUriRes (Application redirect URL after login)</li>
<li>logoutRedirectUriRes (Application redirect URL after logout)</li>
<li>scopeRes (OpenID scopes for application. See the <em>Getting started with VaultITMobileSSOFramework</em> document for the list of available scopes).</li>
</ul>
<h3>Authentication Context Reference</h3>
<p>The Nordic eID supports multiple different authentication method. Currently they are bankid (for Swedish users), tupas (for Finnish users) and internal (general username/password). You can define the used ACR by giving <em>Map&lt;String,String&gt; additionalParams</em> as a parameter to the authorize-function. The map should have a key <em>acr_values</em> with value</p>
<ul>
<li>tupas</li>
<li>bankid</li>
</ul>
<h2>Basic VaultITMobileSSOFramework usage</h2>
<p>Below are instructions how to use the VaultITMobileSSOFramework in Android application. Implement <em>SessionManager.SessionListener</em> in your activity class and construct the <em>SessionManager</em> class. The <em>IdentityProvider</em> class is used to pass on the the OpenID Connect Provider and client settings.</p>
<h3>SessionListener</h3>
<p>The framework comes with <em>SessionListener</em> interface (<a class="el" href="interfaceorg_1_1vaultit_1_1mobilesso_1_1mobilessosdk_1_1_session_manager_1_1_session_listener.html">org.vaultit.mobilesso.mobilessosdk.SessionManager.SessionListener</a>). Implement the interface in the application to receive notifications and changes to session status.</p>
<h3>Executor</h3>
<p>Use <a href="https://developer.android.com/reference/java/util/concurrent/Executors.html">Executors</a> to launch jobs in separate threads. Quick example: </p><pre class="fragment">private ExecutorService mExecutor;
....
if (mExecutor.isShutdown()) {
  mExecutor = Executors.newSingleThreadExecutor();
}
...
mExecutor.submit(() -&gt; mSessionManager.initialize());
</pre><h3>Initialization</h3>
<p>The Initialization will fetch information from the OpenID Connect provider discovery endpoint and load previously stored data. The IdentityProvider object is given as a parameter and the Activity which use the <em>SessionManager</em> object. </p><pre class="fragment">    @Override
    protected void onCreate(Bundle savedInstanceState)  {
        ....
        mSessionManager  = new SessionManager(this,mIdentityProvider);
        ....
    }
</pre><h3>Starting authentication process</h3>
<p>Authentication process will redirect the user to the OpenID Connect Providers authentication process. It will use the system browser to achieve SSO between different applications. After successful authentication and token exchange, the VaultITMobileSSOFramework will redirect to the given application's Intent. Application can request the access token from VaultITMobileSSOFramework and perform authenticated request to protected APIs. Use the method: </p><pre class="fragment">public void authorize(Intent tokenResponseIntent)
</pre><p>to start the authentication process.</p>
<h3>Logout</h3>
<p>Logout method will check user's session status and call logout method if the user's session is active. It will first refresh tokens if they have been expired. The actual logout will be performed with system browser and it is redirected back to the application for the Intent that was given as a parameter. Call </p><pre class="fragment">public void logout(final Intent intent, final int color)
</pre><p>to start the logout process.</p>
<h3>Refresh tokens</h3>
<p>The access token's expiration time is short (5 minutes). After it has expired, fresh access token can be requested by the calling method: </p><pre class="fragment">public void getFreshSession(TokenRefreshCallback callback)
</pre><p>This will renew access token and ID token from OpenID Connect Provider.</p>
<h3>Authentication status</h3>
<p>By implementing the <em>SessionListener</em> and registering the listener, the application will receive changes to the session status. The <em>Session</em> class will given as a parameter to the session changes. The object can be used to get current authentication status, check if the sessions needs a refresh or to get <em>accessToken</em> to make authorized requests: </p><pre class="fragment">mSession.getAccessToken();
</pre><h2>Known issues</h2>
<h2>License</h2>
<p>The VaultITMobileSSOFramework is released under the <a href="http://www.apache.org/licenses/">Apache License Version 2.0</a> license. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
